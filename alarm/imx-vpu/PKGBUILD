# Maintainer: CruX <crux@project-insanity.org>
# Contributor: pepedog at archlinuxarm dot com

buildarch=4
pkgname=imx-vpu
pkgver=3.10.9_1.0.0
_pkgver=${pkgver/_/-}
pkgrel=1
pkgdesc="Freescale VPU library - proprietary extensions for i.MX6q SoC"

# filesystem prefix for the include files and license
#_install_prefix=/usr
# filesystem prefix for the libraries
#_install_exec_prefix=/usr

url="https://community.freescale.com/docs/DOC-95560"
arch=('armv7h')
license=('proprietary')
source=("http://www.freescale.com/lgfiles/NMG/MAD/YOCTO/${pkgname}-${_pkgver}.bin" '99-mxc-vpu.rules')
md5sums=('61331c9ed2d4c1b3aeab9c35fd034ac3'
          'b749d82b96a323d8f914c63c65de9f92')


prepare() {
  cd "${srcdir}"
  sh ${pkgname}-${_pkgver}.bin --force --auto-accept
  sed -n '/EOEULA/,/EOEULA/p' ${pkgname}-${_pkgver}.bin | grep -v EOEULA > LICENSE.$pkgname
}

build() {
  cd "${pkgname}-${_pkgver}"
  export PLATFORM="IMX6Q"
  make all
}

package() {
  cd "${pkgname}-${_pkgver}"
  make DEST_DIR="${pkgdir}" install
#  mkdir -p "${pkgdir}/${_install_prefix}/include" "${pkgdir}/${_install_exec_prefix}/lib"
#  mv "${pkgdir}/${pkgname}"/usr/include/* "${pkgdir}/${_install_prefix}/include/"
#  mv "${pkgdir}/${pkgname}"/usr/lib/* "${pkgdir}/${_install_exec_prefix}/lib/"
#  rm -r "${pkgdir}/${pkgname}"

#  mkdir -p "${pkgdir}/etc/ld.so.conf.d"
#  echo "${_install_exec_prefix}/lib" > "${pkgdir}/etc/ld.so.conf.d/$pkgname.conf"

  install -D -m0644 "${srcdir}/99-mxc-vpu.rules" "${pkgdir}/usr/lib/udev/rules.d/99-mxc-vpu.rules"
}

# vim:set ts=2 sw=2 et:
